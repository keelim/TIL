# 프로세스와 스레드

- [프로세스와 스레드](#프로세스와-스레드)
  - [프로세스(Process)](#프로세스process)
  - [스레드(Thread)](#스레드thread)
  - [프로세스와 스레드의 차이](#프로세스와-스레드의-차이)
  - [동기화 방법](#동기화-방법)
    - [임계 구역](#임계-구역)
  - [멀티 프로세스 vs 멀티 스레드](#멀티-프로세스-vs-멀티-스레드)

## 프로세스(Process)

프로세스는 실행 중인 프로그램으로 디스크로부터 메모리에 적재되어 CPU 의 할당을 받을 수 있는 것을 말한다. 운영체제로부터 주소 공간, 파일, 메모리 등을 할당받으며 이것들을 총칭하여 프로세스라고 한다. 또한 프로세스는 프로세스 실행 중에 동적으로 할당되는 메모리인 힙을 포함한다.

프로세스 주소 공간에는 코드, 데이터, 스택으로 이루어져 있다.

- **코드 Segment** : 프로그램 소스 코드 저장
- **데이터 Segment** : 전역 변수 저장
- **스택 Segment** : 함수, 지역 변수 저장

- 공간을 나눈 이유
  최대한 효율적으로 사용하기 때문에
  Code는 같은 프로그램 자체에서는 모두 같은 내용, 관리하여 공유함 Stack과 데이터를 나눈 이유는, 스택 구조의 특성과 전역 변수의 활용성을 위해

  - Code : 코드 자체를 구성하는 메모리 영역(프로그램 명령)

- Data : 전역변수, 정적변수, 배열 등
  - 초기화 된 데이터는 data 영역에 저장
  - 초기화 되지 않은 데이터는 bss 영역에 저장
- Heap : 동적 할당 시 사용 (new(), mallock() 등)

- Stack : 지역변수, 매개변수, 리턴 값 (임시 메모리 영역)

스레드는 Stack만 따로 할당 받고 나머지 영역은 서로 공유

하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드 같이 생성

## 스레드(Thread)

스레드는 프로세스의 실행 단위. 한 프로세스 내에서 동작되는 여러 실행 흐름으로 프로세스 내의 주소 공간이나 자원을 공유할 수 있다. 하나의 프로세스를 다수의 실행 단위로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상시키는 것을 멀티스레딩이라고 한다. 이 경우 각각의 스레드는 독립적인 작업을 수행해야 하기 때문에 각자의 스택과 PC 레지스터 값을 갖고 있다.

## 프로세스와 스레드의 차이

개념적
`프로세스`는 OS에서 리소스를 할당받는 작업 단위
`스레드`는 프로세스가 할당받은 리소르를 이용하는 실행 단위

구조적 (스레드는 독립적인 레지스터와 스택을 갖는다)

- 독립적인 레지스터가 있는 이유?
  스레드는 독립적인 실행이 가능한데 이를 위해서는 (인자, 변수, 주소값 등등) 을 저장하려는 메모리 공간 (스택) 이 필요하다. 이를 통해 독립적인 함수 호출이 가능하다. 따라서 독립적인 스택이 필요하다.

- 독립적인 스택이 있는 이유?
  스케줄링에 따라서 멈출 수 있고 재실행될 수 있어서 각각의 스레드가 어디까지 실행이 되었는지 기억을 할 필요가 있다. 이를 위해 독립적인 레지스터로 기억을 할 필요가 있다. 따라서 레지스터를 독립적으로 할당한다

또한, 스레드는 프로세스보다 생성 및 종료시간, 스레드간 전환시간이 짧다. 스레드는 프로세스의 메모리, 자원등을 공유하므로 커널의 도움없이 상호간에 통신이 가능하다.

## 동기화 방법

### 임계 구역

여러 프로세스가 데이터를 공유하며 수행될 때, `각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 부분`

공유 데이터를 여러 프로세스가 동시에 접근할 때 잘못된 결과를 만들 수 있기 때문에, 한 프로세스가 임계 구역을 수행할 때는 다른 프로세스가 접근하지 못하도록 해야 한다.

뮤텍스 / 세마포어 / 모니터 동기화를 사용하기 위한 방법이다.

전자(뮤텍스,모니터)는 상호 배제를 함으로써 임계구역에 하나의 스레드만 들어갈 수 있다.
후자(세마포어)는 하나의 스레드(binary 세마포어)만 들어가거나 혹은 여러 개의 스레드(counting 세마포어)가 들어가게 할 수도 있다.

- 뮤텍스, 세마포어 차이

가장 큰 차이는 뮤텍스는 다른 프로세스(애플리케이션)간에 동기화를 위해 사용한다. 반면 모니터는 하나의 프로세스(애플리케이션)내에 다른 스레드 간에 동기화할 때 사용한다. 또한, 뮤텍스는 보통 운영체제 커널 의해서 제공되는 반면에 모니터는 프레임워크나 라이브러리 그 자체에서 제공된다.

- 세마포어, 모니터 차이

세마포어는 카운터라는 변수값을 따로 조정을 해주어야 한다. 반면, 모니터는 이러한 일들이 캡슐화 되어 있어서 개발자는 synchronized, wait(), notify() 로 조정을 할 수 있다.

- 뮤텍스, 세마포어 차이

세마포어는 뮤텍스가 될 수 있다. 하지만 역은 성립하지 않는다. 뮤텍스는 소유가 가능하면 소유자에게 책임이 있으며 세마포어는 소유할 수 없다. 뮤텍스는 1개, 세마포어는 1개 이상 동기화가 가능하다.

## 멀티 프로세스 vs 멀티 스레드

먼저 멀티 프로세스의 경우 OS 로부터 각각 리소스를 할당 받아서 독립적이기 때문에 하나의 프로세스가 오류 있어도 다른 프로세스는 영향을 끼치지 않는다. 하지만 많은 메모리 공간 및 리소스가 필요합니다.

하지만, 멀티 스레드의 경우 이러한 자원을 공유하기 때문에 적은 메모리 공간(전역 변수의 공간 또는 동적으로 할당된 공간인 Heap 영역을 이용하여 데이터를 주고받을 수 있다)과 문맥 전환(스레드의 문맥교환 는 프로세스 문맥교환 와는 달리 캐시 메모리를 비울 필요가 없기 때문에 더 빠르다)이 빠릅니다. 하지만 하나의 스레드로 인해서 여러 스레드가 영향을 끼치며 동기화가 필요하다. 또한 과도한 동기화 작업으로 병목 현상이 일어날 수 있습니다
